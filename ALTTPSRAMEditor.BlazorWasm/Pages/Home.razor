@page "/"
@inject GameService GameService
@inject TextCharacterData TextCharacterData
@inject IJSRuntime JsRuntime

<MudPaper Class="p-6 mb-6">
    <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
        <div>
            <MudText Typo="@Typo.h4">SRAM Editor</MudText>
            <MudText Typo="@Typo.subtitle2"
                     Color="@Color.Secondary">Load an SRAM file to begin editing.
            </MudText>
        </div>
        <div class="relative inline-block">
            <MudButton Variant="@Variant.Filled"
                       Color="@Color.Primary"
                       StartIcon="@Icons.Material.Filled.UploadFile">
                Load SRAM
            </MudButton>
            <InputFile OnChange="@HandleFileSelected"
                       accept=".srm"
                       class="absolute inset-0 h-full w-full cursor-pointer opacity-0"/>
        </div>
    </div>
    @if (!string.IsNullOrWhiteSpace(StatusMessage))
    {
        <MudAlert Severity="@Severity.Info"
                  Dense="@true"
                  Class="mt-4">@StatusMessage</MudAlert>
    }
</MudPaper>

@if (GameService.HasLoadedFile)
{
    <div class="grid grid-cols-1 gap-4 lg:grid-cols-3">
        <MudPaper Class="p-4">
            <MudText Typo="@Typo.subtitle1">Current File</MudText>
            <MudRadioGroup T="int"
                           @bind-Value="@SelectedSlot"
                           Class="mt-2">
                <MudRadio T="int"
                          Value="1"
                          Color="@Color.Primary">File 1
                </MudRadio>
                <MudRadio T="int"
                          Value="2"
                          Color="@Color.Primary">File 2
                </MudRadio>
                <MudRadio T="int"
                          Value="3"
                          Color="@Color.Primary">File 3
                </MudRadio>
            </MudRadioGroup>
            <MudStack Spacing="1"
                      Class="mt-4">
                <MudButton Variant="@Variant.Outlined"
                           OnClick="@CreateFile">Create
                </MudButton>
                <MudButton Variant="@Variant.Outlined"
                           OnClick="@CopyFile">Copy
                </MudButton>
                <MudButton Variant="@Variant.Outlined"
                           OnClick="@WriteFile">Write
                </MudButton>
                <MudButton Variant="@Variant.Outlined"
                           Color="@Color.Error"
                           OnClick="@EraseFile">Erase
                </MudButton>
            </MudStack>
        </MudPaper>

        <MudPaper Class="p-4">
            <MudText Typo="@Typo.subtitle1">Filename</MudText>
            <div class="relative mt-2 h-12 w-48">
                <img class="pixelated h-full w-full"
                     src="@GetResourceUrl(GetFilenamePanelImage())"
                     alt="Filename panel"/>
                <img class="pixelated absolute left-2 top-2 h-6 w-6"
                     src="@GetResourceUrl("Player Name Heart.png")"
                     alt="Heart"/>
                <span class="absolute left-10 top-2 text-sm font-semibold tracking-widest text-white">
                @PlayerName
            </span>
            </div>
            <MudTextField @bind-Value="@PlayerName"
                          Label="Player Name"
                          Variant="@Variant.Outlined"
                          Class="mt-3"/>
            <MudStack Row="true"
                      Spacing="1"
                      Class="mt-3 flex-wrap">
                <MudButton Variant="@Variant.Filled"
                           Color="@Color.Primary"
                           OnClick="@ApplyPlayerName">Change Name
                </MudButton>
                <MudButton Variant="@Variant.Outlined"
                           OnClick="@ResetDeaths">Reset Deaths
                </MudButton>
            </MudStack>
            <MudDivider Class="my-4"/>
            <MudText Typo="@Typo.subtitle2"
                     Color="@Color.Secondary">Region: @CurrentRegion</MudText>
        </MudPaper>

        <MudPaper Class="p-4">
            <MudText Typo="@Typo.subtitle1">Inventory</MudText>
            <div class="mt-3 grid grid-cols-5 gap-2 rounded bg-black p-3">
                @foreach (var slot in InventorySlots)
                {
                    <button type="button"
                            class="flex items-center justify-center rounded border border-slate-700 bg-slate-900 p-1 hover:border-slate-400"
                            @onclick="@(() => ToggleInventoryItem(slot))">
                        <img class="pixelated h-10 w-10"
                             src="@slot.ImageSelector()"
                             alt="@slot.Name"/>
                    </button>
                }
            </div>
        </MudPaper>
    </div>

    <div class="grid grid-cols-1 gap-4 lg:grid-cols-2 mt-4">
        <MudPaper Class="p-4">
            <MudText Typo="@Typo.subtitle1">Inventory Item States</MudText>
            <div class="mt-3 grid gap-3">
                @foreach (var group in InventoryStateGroups)
                {
                    <div class="inventory-state-panel rounded border border-slate-600 bg-slate-900 p-3 text-slate-100">
                        <MudText Typo="@Typo.subtitle2"
                                 Color="@Color.Secondary">@group.Name</MudText>
                        <MudRadioGroup T="int"
                                       Value="@GetItemValue(group.Address)"
                                       ValueChanged="value => SetItemValue(group.Address, value)"
                                       Class="mt-2">
                            @foreach (var option in group.Options)
                            {
                                <MudRadio T="int"
                                          Value="@option.Value"
                                          Color="@Color.Primary">@option.Label</MudRadio>
                            }
                        </MudRadioGroup>
                    </div>
                }
            </div>
        </MudPaper>

        <MudPaper Class="p-4">
            <MudText Typo="@Typo.subtitle1">Bottles</MudText>
            <div class="mt-3 grid gap-3">
                <div class="bottle-panel flex items-center gap-3 rounded border border-slate-600 bg-slate-900 p-3 text-slate-100">
                    <img class="pixelated h-10 w-10"
                         src="@GetBottleContentImage(Bottle1Value)"
                         alt="Bottle 1 contents"/>
                    <MudSelect T="int"
                               @bind-Value="@Bottle1Value"
                               Label="Bottle 1"
                               Variant="@Variant.Outlined"
                               Dense="true">
                        @foreach (var option in BottleOptions)
                        {
                            <MudSelectItem T="int"
                                           Value="@option.Value">@option.Label</MudSelectItem>
                        }
                    </MudSelect>
                </div>
                <div class="bottle-panel flex items-center gap-3 rounded border border-slate-600 bg-slate-900 p-3 text-slate-100">
                    <img class="pixelated h-10 w-10"
                         src="@GetBottleContentImage(Bottle2Value)"
                         alt="Bottle 2 contents"/>
                    <MudSelect T="int"
                               @bind-Value="@Bottle2Value"
                               Label="Bottle 2"
                               Variant="@Variant.Outlined"
                               Dense="true">
                        @foreach (var option in BottleOptions)
                        {
                            <MudSelectItem T="int"
                                           Value="@option.Value">@option.Label</MudSelectItem>
                        }
                    </MudSelect>
                </div>
                <div class="bottle-panel flex items-center gap-3 rounded border border-slate-600 bg-slate-900 p-3 text-slate-100">
                    <img class="pixelated h-10 w-10"
                         src="@GetBottleContentImage(Bottle3Value)"
                         alt="Bottle 3 contents"/>
                    <MudSelect T="int"
                               @bind-Value="@Bottle3Value"
                               Label="Bottle 3"
                               Variant="@Variant.Outlined"
                               Dense="true">
                        @foreach (var option in BottleOptions)
                        {
                            <MudSelectItem T="int"
                                           Value="@option.Value">@option.Label</MudSelectItem>
                        }
                    </MudSelect>
                </div>
                <div class="bottle-panel flex items-center gap-3 rounded border border-slate-600 bg-slate-900 p-3 text-slate-100">
                    <img class="pixelated h-10 w-10"
                         src="@GetBottleContentImage(Bottle4Value)"
                         alt="Bottle 4 contents"/>
                    <MudSelect T="int"
                               @bind-Value="@Bottle4Value"
                               Label="Bottle 4"
                               Variant="@Variant.Outlined"
                               Dense="true">
                        @foreach (var option in BottleOptions)
                        {
                            <MudSelectItem T="int"
                                           Value="@option.Value">@option.Label</MudSelectItem>
                        }
                    </MudSelect>
                </div>
            </div>
        </MudPaper>
    </div>

    <div class="grid grid-cols-1 gap-4 lg:grid-cols-3 mt-4">
        <MudPaper Class="p-4 lg:col-span-2">
            <MudText Typo="@Typo.subtitle1">HUD</MudText>
            <div class="grid grid-cols-1 gap-3 md:grid-cols-3 mt-3">
                <MudNumericField T="int"
                                 @bind-Value="@HeartContainers"
                                 Label="Heart Containers"
                                 Variant="@Variant.Outlined"
                                 Min="8"
                                 Max="160"/>
                <MudNumericField T="int"
                                 @bind-Value="@CurrentMagic"
                                 Label="Magic"
                                 Variant="@Variant.Outlined"
                                 Min="0"
                                 Max="128"/>
                <MudNumericField T="int"
                                 @bind-Value="@Rupees"
                                 Label="Rupees"
                                 Variant="@Variant.Outlined"
                                 Min="0"
                                 Max="999"/>
            </div>
            <div class="mt-3 grid grid-cols-10 gap-1">
                @for (var i = 0; i < 20; i++)
                {
                    <div class="flex items-center justify-center">
                        @if (i < DisplayHearts)
                        {
                            <img class="pixelated h-6 w-6"
                                 src="@GetResourceUrl("HeartContainerFull.png")"
                                 alt="Heart"/>
                        }
                        else
                        {
                            <div class="h-6 w-6"></div>
                        }
                    </div>
                }
            </div>
            <div class="mt-2 flex items-center gap-4">
                @if (HeartPieces > 0)
                {
                    <img class="pixelated h-6 w-6"
                         src="@GetResourceUrl(GetHeartPieceImage())"
                         alt="Heart piece"/>
                }
                <div class="relative h-[45px] w-[16px]">
                    <img class="pixelated h-full w-full"
                         src="@GetResourceUrl(GetMagicBarImage())"
                         alt="Magic bar outline"/>
                    <div class="absolute bottom-0"
                         style="@GetMagicFillStyle()"></div>
                    @if (CurrentMagic > 0)
                    {
                        <div class="absolute"
                             style="@GetMagicHighlightStyle()"></div>
                    }
                </div>
            </div>
            <div class="grid grid-cols-1 gap-3 md:grid-cols-4 mt-3">
                <MudNumericField T="int"
                                 @bind-Value="@ArrowUpgrades"
                                 Label="Arrow Upgrades"
                                 Variant="@Variant.Outlined"
                                 Min="0"
                                 Max="7"/>
                <MudNumericField T="int"
                                 @bind-Value="@ArrowsHeld"
                                 Label="Arrows Held"
                                 Variant="@Variant.Outlined"
                                 Min="0"
                                 Max="@MaxArrows"/>
                <MudNumericField T="int"
                                 @bind-Value="@BombUpgrades"
                                 Label="Bomb Upgrades"
                                 Variant="@Variant.Outlined"
                                 Min="0"
                                 Max="7"/>
                <MudNumericField T="int"
                                 @bind-Value="@BombsHeld"
                                 Label="Bombs Held"
                                 Variant="@Variant.Outlined"
                                 Min="0"
                                 Max="@MaxBombs"/>
            </div>
            <MudStack Row="true"
                      Spacing="1"
                      Class="mt-4 flex-wrap">
                <MudButton Variant="@Variant.Filled"
                           Color="@Color.Primary"
                           OnClick="@ApplyPlayerChanges">Apply Changes
                </MudButton>
                <MudButton Variant="@Variant.Outlined"
                           OnClick="@CycleMagicUpgrade">Cycle Magic Upgrade (@MagicUpgrade)
                </MudButton>
            </MudStack>
        </MudPaper>

        <MudPaper Class="p-4">
            <MudText Typo="@Typo.subtitle1">Pendants and Crystals</MudText>
            <div class="mt-3 grid gap-3">
                <div class="grid grid-cols-3 gap-2 rounded bg-black p-3">
                    @foreach (var pendant in PendantSlots)
                    {
                        <button type="button"
                                class="flex items-center justify-center rounded border border-transparent hover:border-slate-400"
                                @onclick="@(() => TogglePendant(pendant))">
                            <img class="pixelated h-10 w-10"
                                 src="@pendant.ImageSelector()"
                                 alt="@pendant.Name"/>
                        </button>
                    }
                </div>
                <div class="grid grid-cols-4 gap-2 rounded bg-black p-3">
                    @foreach (var crystal in CrystalSlots)
                    {
                        <button type="button"
                                class="flex items-center justify-center rounded border border-transparent hover:border-slate-400"
                                @onclick="@(() => ToggleCrystal(crystal))">
                            <img class="pixelated h-8 w-8"
                                 src="@crystal.ImageSelector()"
                                 alt="@crystal.Name"/>
                        </button>
                    }
                </div>
            </div>
        </MudPaper>
    </div>

    <MudPaper Class="p-4 mt-4 flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
        <MudText Typo="@Typo.subtitle2"
                 Color="@Color.Secondary">Ready to download updated SRAM.
        </MudText>
        <MudButton Variant="@Variant.Filled"
                   Color="@Color.Success"
                   StartIcon="@Icons.Material.Filled.Download"
                   OnClick="@SaveFile">
            Download Updated SRAM
        </MudButton>
    </MudPaper>
}
